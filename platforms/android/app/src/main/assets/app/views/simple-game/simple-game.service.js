"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var SimpleGameService = /** @class */ (function () {
    function SimpleGameService() {
        this.Q_COLOR = '#666';
        this.NO_COLOR = '#aaa';
        this.ALL_COLORS = [
            { color: '#607D8B' },
            { color: '#795548' },
            { color: '#C62828' },
            { color: '#FF5722' },
            { color: '#FF9900' },
            { color: '#FFD600' },
            { color: '#AFB42B' },
            { color: '#7CB342' },
            { color: '#4CAF50' },
            { color: '#009688' },
            { color: '#00BCD4' },
            { color: '#2196F3' },
            { color: '#3F51B5' },
            { color: '#4527A0' },
            { color: '#9C27B0' },
            { color: '#E91E63' } // pink
        ];
        this.emptyDot = { color: this.NO_COLOR };
        this.dotsCount = 5;
        this.colorsCount = 8;
        this.current = [];
        this.width = 45;
        this.colorWidth = 35;
        this.colors = this.ALL_COLORS;
        this.question = { dots: [] };
        // userAnswers
        this._userAnswers = [];
        // activeInputIndex
        this._activeInputIndex = 0;
        this.chooseColors();
        for (var i = 0; i < this.dotsCount; i++) {
            this.current.push(Object.assign({}, this.emptyDot));
            this.question.dots.push(Object.assign({}, this.colors[getRandomInt(this.dotsCount)]));
        }
        this.width = 45;
        this.colorWidth = 40;
        this.revealQuestionEvent = new core_1.EventEmitter();
        this.newAnswerAdded = new core_1.EventEmitter();
    }
    Object.defineProperty(SimpleGameService.prototype, "userAnswers", {
        get: function () {
            return this._userAnswers;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SimpleGameService.prototype, "activeInputIndex", {
        get: function () {
            return this._activeInputIndex;
        },
        set: function (i) {
            if (i < this.dotsCount)
                this._activeInputIndex = i;
            else
                this._activeInputIndex = this._activeInputIndex;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SimpleGameService.prototype, "revealQuestion", {
        set: function (current) {
            this.revealQuestionEvent.emit({ reveal: true });
        },
        enumerable: true,
        configurable: true
    });
    SimpleGameService.prototype.emitUserAnswerAdded = function () {
        this.newAnswerAdded.emit({});
    };
    SimpleGameService.prototype.chooseColors = function () {
        var colorInc = Math.floor(this.ALL_COLORS.length / this.colorsCount);
        this.colors = [];
        // let j = 0;
        for (var i = 0; i < this.colorsCount; i++) {
            this.colors.push(this.ALL_COLORS[i]);
            // j += colorInc;
        }
    };
    SimpleGameService.prototype.setInputColor = function (color) {
        this.current[this.activeInputIndex].color = color;
        this.activeInputIndex += 1;
    };
    SimpleGameService.prototype.submitInput = function () {
        // check input
        var answer = this.current.map(function (x) { return Object.assign({}, x); });
        var question = this.question.dots.map(function (x) { return Object.assign({}, x); });
        var hasResult = function (dot) { return dot.correct || dot.place; };
        var correctAnswer = true;
        question.forEach(function (Qdot, i) {
            if (Qdot.color === answer[i].color) {
                answer[i].correct = true;
                Qdot.correct = true;
            }
            else {
                correctAnswer = false;
            }
        });
        if (!correctAnswer) {
            question.forEach(function (Qdot, i) {
                if (!hasResult(Qdot)) {
                    answer.some(function (Adot) {
                        if (Adot.color == Qdot.color && !hasResult(Adot)) {
                            Qdot.place = true;
                            Adot.place = true;
                            correctAnswer = false;
                            return true;
                        }
                    });
                }
            });
        }
        else {
            this.revealQuestion = true;
        }
        this.userAnswers.push({ dots: answer });
        this.emitUserAnswerAdded();
    };
    SimpleGameService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], SimpleGameService);
    return SimpleGameService;
}());
exports.SimpleGameService = SimpleGameService;
var getRandomInt = function (max) {
    return Math.floor(Math.random() * Math.floor(max));
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2ltcGxlLWdhbWUuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInNpbXBsZS1nYW1lLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBeUQ7QUFHekQ7SUEwREM7UUF6REEsWUFBTyxHQUFHLE1BQU0sQ0FBQztRQUNqQixhQUFRLEdBQUcsTUFBTSxDQUFDO1FBQ2xCLGVBQVUsR0FBRztZQUNaLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUNwQixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDcEIsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUNwQixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDcEIsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUNwQixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDcEIsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUNwQixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDcEIsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUNwQixFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7WUFDcEIsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFO1lBQ3BCLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUFDLE9BQU87U0FDNUIsQ0FBQztRQUNNLGFBQVEsR0FBRyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDNUMsY0FBUyxHQUFHLENBQUMsQ0FBQztRQUNkLGdCQUFXLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLFlBQU8sR0FBRyxFQUFFLENBQUM7UUFDYixVQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ1gsZUFBVSxH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QUFJO3dCQUNmLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ2xELElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDOzRCQUNsQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQzs0QkFDbEIsYUFBYSxHQUFHLEtBQUssQ0FBQzs0QkFDdEIsTUFBTSxDQUFDLElBQUksQ0FBQzt3QkFDYixDQUFDO29CQUNGLENBQUMsQ0FBQyxDQUFDO2dCQUNKLENBQUM7WUFDRixDQUFDLENBQUMsQ0FBQztRQUNKLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNQLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQzVCLENBQUM7UUFFRCxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFySFcsaUJBQWlCO1FBRDdCLGlCQUFVLEVBQUU7O09BQ0EsaUJBQWlCLENBc0g3QjtJQUFELHdCQUFDO0NBQUEsQUF0SEQsSUFzSEM7QUF0SFksOENBQWlCO0FBd0g5QixJQUFNLFlBQVksR0FBRyxVQUFBLEdBQUc7SUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUNwRCxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlLCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFNpbXBsZUdhbWVTZXJ2aWNlIHtcblx0UV9DT0xPUiA9ICcjNjY2Jztcblx0Tk9fQ09MT1IgPSAnI2FhYSc7XG5cdEFMTF9DT0xPUlMgPSBbXG5cdFx0eyBjb2xvcjogJyM2MDdEOEInIH0sIC8vIGdyYXlcblx0XHR7IGNvbG9yOiAnIzc5NTU0OCcgfSwgLy8gYnJvd25cblx0XHR7IGNvbG9yOiAnI0M2MjgyOCcgfSwgLy8gZGFyayByZWRcblx0XHR7IGNvbG9yOiAnI0ZGNTcyMicgfSwgLy8gcmVkXG5cdFx0eyBjb2xvcjogJyNGRjk5MDAnIH0sIC8vIG9yYW5nZVxuXHRcdHsgY29sb3I6ICcjRkZENjAwJyB9LCAvLyB5ZWxsb3dcblx0XHR7IGNvbG9yOiAnI0FGQjQyQicgfSwgLy8gcG9velxuXHRcdHsgY29sb3I6ICcjN0NCMzQyJyB9LCAvLyBwYXN0ZWlcblx0XHR7IGNvbG9yOiAnIzRDQUY1MCcgfSwgLy8gZ3JlZW5cblx0XHR7IGNvbG9yOiAnIzAwOTY4OCcgfSwgLy8gbmFmdGlcblx0XHR7IGNvbG9yOiAnIzAwQkNENCcgfSwgLy8gY3lhblxuXHRcdHsgY29sb3I6ICcjMjE5NkYzJyB9LCAvLyBibHVlXG5cdFx0eyBjb2xvcjogJyMzRjUxQjUnIH0sIC8vIGRhcmsgYmx1ZVxuXHRcdHsgY29sb3I6ICcjNDUyN0EwJyB9LCAvLyBwdXJwbGVcblx0XHR7IGNvbG9yOiAnIzlDMjdCMCcgfSwgLy8gcHVycGxlIHBpbmtcblx0XHR7IGNvbG9yOiAnI0U5MUU2MycgfSAvLyBwaW5rXG5cdF07XG5cdHByaXZhdGUgZW1wdHlEb3QgPSB7IGNvbG9yOiB0aGlzLk5PX0NPTE9SIH07XG5cdGRvdHNDb3VudCA9IDU7XG5cdGNvbG9yc0NvdW50ID0gODtcblx0Y3VycmVudCA9IFtdO1xuXHR3aWR0aCA9IDQ1O1xuXHRjb2xvcldpZHRoID0gMzU7XG5cdGNvbG9ycyA9IHRoaXMuQUxMX0NPTE9SUztcblx0cXVlc3Rpb24gPSB7IGRvdHM6IFtdIH07XG5cblx0Ly8gdXNlckFuc3dlcnNcblx0cHJpdmF0ZSBfdXNlckFuc3dlcnMgPSBbXTtcblx0Z2V0IHVzZXJBbnN3ZXJzKCkge1xuXHRcdHJldHVybiB0aGlzLl91c2VyQW5zd2Vycztcblx0fVxuXG5cdC8vIGFjdGl2ZUlucHV0SW5kZXhcblx0cHJpdmF0ZSBfYWN0aXZlSW5wdXRJbmRleCA9IDA7XG5cdHNldCBhY3RpdmVJbnB1dEluZGV4KGkpIHtcblx0XHRpZiAoaSA8IHRoaXMuZG90c0NvdW50KSB0aGlzLl9hY3RpdmVJbnB1dEluZGV4ID0gaTtcblx0XHRlbHNlIHRoaXMuX2FjdGl2ZUlucHV0SW5kZXggPSB0aGlzLl9hY3RpdmVJbnB1dEluZGV4O1xuXHR9XG5cdGdldCBhY3RpdmVJbnB1dEluZGV4KCkge1xuXHRcdHJldHVybiB0aGlzLl9hY3RpdmVJbnB1dEluZGV4O1xuXHR9XG5cblx0Ly8gcmV2ZWFsUXVlc3Rpb25cblx0cmV2ZWFsUXVlc3Rpb25FdmVudDogRXZlbnRFbWl0dGVyPGFueT47XG5cdHNldCByZXZlYWxRdWVzdGlvbihjdXJyZW50KSB7XG5cdFx0dGhpcy5yZXZlYWxRdWVzdGlvbkV2ZW50LmVtaXQoeyByZXZlYWw6IHRydWUgfSk7XG5cdH1cblxuXHQvLyByZXZlYWxRdWVzdGlvblxuXHRuZXdBbnN3ZXJBZGRlZDogRXZlbnRFbWl0dGVyPGFueT47XG5cdGVtaXRVc2VyQW5zd2VyQWRkZWQoKSB7XG5cdFx0dGhpcy5uZXdBbnN3ZXJBZGRlZC5lbWl0KHt9KTtcblx0fVxuXG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHRoaXMuY2hvb3NlQ29sb3JzKCk7XG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmRvdHNDb3VudDsgaSsrKSB7XG5cdFx0XHR0aGlzLmN1cnJlbnQucHVzaChPYmplY3QuYXNzaWduKHt9LCB0aGlzLmVtcHR5RG90KSk7XG5cdFx0XHR0aGlzLnF1ZXN0aW9uLmRvdHMucHVzaChPYmplY3QuYXNzaWduKHt9LCB0aGlzLmNvbG9yc1tnZXRSYW5kb21JbnQodGhpcy5kb3RzQ291bnQpXSkpO1xuXHRcdH1cblx0XHR0aGlzLndpZHRoID0gNDU7XG5cdFx0dGhpcy5jb2xvcldpZHRoID0gNDA7XG5cdFx0dGhpcy5yZXZlYWxRdWVzdGlvbkV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cdFx0dGhpcy5uZXdBbnN3ZXJBZGRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXHR9XG5cblx0cHJpdmF0ZSBjaG9vc2VDb2xvcnMoKSB7XG5cdFx0Y29uc3QgY29sb3JJbmMgPSBNYXRoLmZsb29yKHRoaXMuQUxMX0NPTE9SUy5sZW5ndGggLyB0aGlzLmNvbG9yc0NvdW50KTtcblx0XHR0aGlzLmNvbG9ycyA9IFtdO1xuXHRcdC8vIGxldCBqID0gMDtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29sb3JzQ291bnQ7IGkrKykge1xuXHRcdFx0dGhpcy5jb2xvcnMucHVzaCh0aGlzLkFMTF9DT0xPUlNbaV0pO1xuXHRcdFx0Ly8gaiArPSBjb2xvckluYztcblx0XHR9XG5cdH1cblxuXHRzZXRJbnB1dENvbG9yKGNvbG9yKSB7XG5cdFx0dGhpcy5jdXJyZW50W3RoaXMuYWN0aXZlSW5wdXRJbmRleF0uY29sb3IgPSBjb2xvcjtcblx0XHR0aGlzLmFjdGl2ZUlucHV0SW5kZXggKz0gMTtcblx0fVxuXHRzdWJtaXRJbnB1dCgpIHtcblx0XHQvLyBjaGVjayBpbnB1dFxuXHRcdGxldCBhbnN3ZXIgPSB0aGlzLmN1cnJlbnQubWFwKHggPT4gT2JqZWN0LmFzc2lnbih7fSwgeCkpO1xuXHRcdGNvbnN0IHF1ZXN0aW9uID0gdGhpcy5xdWVzdGlvbi5kb3RzLm1hcCh4ID0+IE9iamVjdC5hc3NpZ24oe30sIHgpKTtcblx0XHRjb25zdCBoYXNSZXN1bHQgPSBkb3QgPT4gZG90LmNvcnJlY3QgfHwgZG90LnBsYWNlO1xuXHRcdGxldCBjb3JyZWN0QW5zd2VyID0gdHJ1ZTtcblx0XHRxdWVzdGlvbi5mb3JFYWNoKChRZG90LCBpKSA9PiB7XG5cdFx0XHRpZiAoUWRvdC5jb2xvciA9PT0gYW5zd2VyW2ldLmNvbG9yKSB7XG5cdFx0XHRcdGFuc3dlcltpXS5jb3JyZWN0ID0gdHJ1ZTtcblx0XHRcdFx0UWRvdC5jb3JyZWN0ID0gdHJ1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGNvcnJlY3RBbnN3ZXIgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHRpZiAoIWNvcnJlY3RBbnN3ZXIpIHtcblx0XHRcdHF1ZXN0aW9uLmZvckVhY2goKFFkb3QsIGkpID0+IHtcblx0XHRcdFx0aWYgKCFoYXNSZXN1bHQoUWRvdCkpIHtcblx0XHRcdFx0XHRhbnN3ZXIuc29tZShBZG90ID0+IHtcblx0XHRcdFx0XHRcdGlmIChBZG90LmNvbG9yID09IFFkb3QuY29sb3IgJiYgIWhhc1Jlc3VsdChBZG90KSkge1xuXHRcdFx0XHRcdFx0XHRRZG90LnBsYWNlID0gdHJ1ZTtcblx0XHRcdFx0XHRcdFx0QWRvdC5wbGFjZSA9IHRydWU7XG5cdFx0XHRcdFx0XHRcdGNvcnJlY3RBbnN3ZXIgPSBmYWxzZTtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnJldmVhbFF1ZXN0aW9uID0gdHJ1ZTtcblx0XHR9XG5cblx0XHR0aGlzLnVzZXJBbnN3ZXJzLnB1c2goeyBkb3RzOiBhbnN3ZXIgfSk7XG5cdFx0dGhpcy5lbWl0VXNlckFuc3dlckFkZGVkKCk7XG5cdH1cbn1cblxuY29uc3QgZ2V0UmFuZG9tSW50ID0gbWF4ID0+IHtcblx0cmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE1hdGguZmxvb3IobWF4KSk7XG59O1xuIl19